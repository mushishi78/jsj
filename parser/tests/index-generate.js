const fs = require("fs");
const path = require("path");

const files = fs.readdirSync(__dirname);
const tests = [];
const readFile = fileName => fs.readFileSync(path.join(__dirname, fileName), "utf8");

for (const file of files) {
  if (file.indexOf(".jsj") < 0) continue;

  const name = file.slice(0, -4);
  const outputExt = files.indexOf(name + ".js") >= 0 ? ".js" : ".error.json";

  const input = readFile(file);
  let output = readFile(name + outputExt);

  // Replace windows file ending (will break old macs)
  output = output.replace(/\r/g, "");

  tests.push({ name, input, output });
}

const index =
  "/* Automatically generated by index-generate.js */\n" +
  "var TESTS = " + JSON.stringify(tests, null, 2);

fs.writeFileSync(path.join(__dirname, "index.js"), index);
